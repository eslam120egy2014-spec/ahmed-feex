<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FedEx | Ahmed Pro V20</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --fedex-purple: #4D148C; --fedex-orange: #FF6200; }
        body { font-family: 'Cairo', sans-serif; background-color: #f1f5f9; }
        .fedex-purple { background-color: var(--fedex-purple); }
        .screen { display: none; }
        .screen.active { display: block; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒØ±ÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© */
        .day-card { border-radius: 20px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: 0.3s; border-right: 8px solid; }
        .card-green { background: #f0fdf4; border-right-color: #22c55e; } /* ÙŠÙˆÙ… Ø´ØºÙ„ ØµØ§ÙÙŠ */
        .card-orange { background: #fff7ed; border-right-color: var(--fedex-orange); } /* ÙŠÙˆÙ… ÙÙŠÙ‡ Ø³Ø­ÙˆØ¨Ø§Øª */
        
        #exportArea { position: fixed; left: -9999px; top: 0; width: 400px; background: white; padding: 25px; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen pb-28">

    <header class="p-5 flex justify-between items-center bg-white shadow-sm sticky top-0 z-50">
        <div class="text-2xl font-black italic"><span style="color:var(--fedex-purple)">Fed</span><span style="color:var(--fedex-orange)">Ex</span></div>
        <button onclick="archiveMonth()" class="text-[10px] bg-red-100 text-red-600 px-3 py-1 rounded-full font-bold">ØªÙ‚ÙÙŠÙ„ Ø§Ù„Ø´Ù‡Ø± ğŸ</button>
    </header>

    <main class="p-5">
        <section id="home" class="screen active text-center">
            <div class="bg-[#4D148C] p-8 rounded-[2.5rem] text-white shadow-2xl mb-8">
                <p class="text-purple-200 text-xs mb-1 font-bold">ØµØ§ÙÙŠ Ù…Ø³ØªØ­Ù‚Ø§ØªÙƒ (Ø¨Ø¯ÙˆÙ† Ø®ØµÙ… Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†)</p>
                <h2 id="netBalance" class="text-5xl font-black">â‚¬0.00</h2>
                <div id="archiveSum" class="hidden mt-4 text-[10px] bg-black/20 p-2 rounded-lg"></div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                    <p class="text-[10px] text-gray-400 font-bold mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø±ÙˆØ¯</p>
                    <p id="totalParcels" class="text-2xl font-black">0</p>
                </div>
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                    <p class="text-[10px] text-gray-400 font-bold mb-1 text-orange-600">Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
                    <p id="totalWithdrawn" class="text-2xl font-black">0â‚¬</p>
                </div>
            </div>
        </section>

        <section id="add" class="screen">
            <div class="space-y-4">
                <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border-t-8 border-purple-800">
                    <h4 class="font-black text-purple mb-4">ØªØ³Ø¬ÙŠÙ„ Ø·Ø±ÙˆØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
                    <input type="number" id="pInput" placeholder="0" class="w-full bg-gray-50 p-4 rounded-2xl mb-4 text-center font-black text-3xl outline-none">
                    <button onclick="saveEntry('delivery')" class="w-full fedex-purple text-white p-4 rounded-2xl font-bold">Ø­ÙØ¸ Ø§Ù„Ø´Ø­Ù†Ø§Øª</button>
                </div>
                <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border-t-8 border-orange-500">
                    <h4 class="font-black text-orange-600 mb-4">Ø³Ø­Ø¨ ÙÙ„ÙˆØ³ (ØªØ­Øª Ø§Ù„Ø­Ø³Ø§Ø¨)</h4>
                    <input type="number" id="wInput" placeholder="â‚¬ 0.00" class="w-full bg-gray-50 p-4 rounded-2xl mb-4 text-center font-black text-3xl outline-none">
                    <button onclick="saveEntry('withdraw')" class="w-full bg-[#FF6200] text-white p-4 rounded-2xl font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø­Ø¨</button>
                </div>
            </div>
        </section>

        <section id="history" class="screen">
            <div class="bg-white p-5 rounded-3xl mb-6 shadow-sm border border-gray-100">
                <h4 class="font-black text-[10px] text-gray-400 mb-4">ØªØµØ¯ÙŠØ± ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ ØµÙˆØ±Ø©</h4>
                <div class="flex gap-2 mb-4">
                    <input type="date" id="dFrom" class="flex-1 bg-gray-50 p-2 rounded-xl text-xs border">
                    <input type="date" id="dTo" class="flex-1 bg-gray-50 p-2 rounded-xl text-xs border">
                </div>
                <button onclick="exportImage()" class="w-full bg-green-600 text-white p-3 rounded-xl text-xs font-bold">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© ğŸ“¸</button>
            </div>
            
            <div id="historyList" class="space-y-4"></div>
        </section>
    </main>

    <div id="exportArea">
        <h1 style="color:#4D148C; text-align:center; margin:0; font-size:24px;">FedEx Statement</h1>
        <p id="exportDates" style="text-align:center; font-size:10px; color:#666;"></p>
        <div id="exportContent" style="margin:20px 0;"></div>
        <div style="background:#4D148C; color:white; padding:15px; border-radius:10px; text-align:center;">
            <p style="margin:0; font-size:10px;">Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
            <h2 id="exportTotal" style="margin:0; font-size:24px;"></h2>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-3 z-50 max-w-md mx-auto shadow-2xl">
        <button onclick="showScreen('home')" class="nav-btn p-2 text-purple flex flex-col items-center">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            <span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </button>
        <button onclick="showScreen('add')" class="-mt-10 fedex-purple text-white p-5 rounded-full shadow-2xl border-4 border-white">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
        <button onclick="showScreen('history')" class="nav-btn p-2 text-gray-300 flex flex-col items-center">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
            <span class="text-[10px] font-bold">Ø§Ù„Ù†ØªÙŠØ¬Ø©</span>
        </button>
    </nav>

    <script>
        const PRICE = 3.8;
        const GAS_COST = 35; // Ù…ØµØ±ÙˆÙ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·
        let db = JSON.parse(localStorage.getItem('fedex_v20')) || { logs: [], archive: 0 };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'history') renderHistory();
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('text-purple', 'text-gray-300'));
            if(event) event.currentTarget.classList.replace('text-gray-300', 'text-purple');
        }

        function saveEntry(type) {
            const date = new Date().toISOString().split('T')[0];
            let val = 0, label = '';
            if(type === 'delivery') {
                const c = parseInt(document.getElementById('pInput').value); if(!c) return;
                val = c * PRICE; label = ØªÙˆØµÙŠÙ„ ${c} Ø·Ø±Ø¯;
            } else {
                const a = parseFloat(document.getElementById('wInput').value); if(!a) return;
                val = -a; label = Ø³Ø­Ø¨ Ø´Ø®ØµÙŠ;
            }
            db.logs.unshift({ id: Date.now(), date, val, label, type });
            save();
            document.getElementById('pInput').value = ''; document.getElementById('wInput').value = '';
            showScreen('home');
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            const groups = db.logs.reduce((acc, l) => {
                acc[l.date] = acc[l.date] || { earn: 0, withdraw: 0, net: 0 };
                if(l.val > 0) acc[l.date].earn += l.val; else acc[l.date].withdraw += Math.abs(l.val);
                acc[l.date].net += l.val; return acc;
            }, {});

            Object.keys(groups).sort().reverse().forEach(date => {
                const g = groups[date];
                const netAfterGas = g.earn - GAS_COST;
                const isWithdraw = g.withdraw > 0;
                
                list.innerHTML += 
                    <div class="day-card ${isWithdraw ? 'card-orange' : 'card-green'}">
                        <div class="flex justify-between items-center mb-3 border-b border-black/5 pb-2">
                            <span class="font-black text-sm text-purple">${date}</span>
                            <span class="bg-purple-800 text-white px-3 py-1 rounded-full text-[10px] font-bold">ØµØ§ÙÙŠ Ø§Ù„Ø±ØµÙŠØ¯: ${g.net.toFixed(1)}â‚¬</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-[11px] font-bold">
                            <div class="text-green-600">Ø§Ù„Ù…ÙƒØ³Ø¨: ${g.earn.toFixed(1)}â‚¬</div>
                            <div class="text-red-500">Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª: ${g.withdraw.toFixed(1)}â‚¬</div>
                            <div class="text-gray-400 italic">Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø²ÙŠÙ†: ${GAS_COST}â‚¬</div>
                            <div class="text-blue-600 underline">Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†: ${netAfterGas.toFixed(1)}â‚¬</div>
                        </div>
                    </div>;
            });
        }

        function exportImage() {
            const from = document.getElementById('dFrom').value;
            const to = document.getElementById('dTo').value;
            if(!from || !to) return alert('Ø­Ø¯Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ®');
            const filtered = db.logs.filter(l => l.date >= from && l.date <= to);
            let total = 0;
            const content = document.getElementById('exportContent');
            content.innerHTML = '';
            filtered.forEach(l => { total += l.val; content.innerHTML += <div style="display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #eee; font-size:12px;"><span>${l.date}</span><span>${l.label}</span><span>${l.val.toFixed(1)}â‚¬</span></div>; });
            document.getElementById('exportDates').innerText = Ù…Ù† ${from} Ø¥Ù„Ù‰ ${to};
            document.getElementById('exportTotal').innerText = total.toFixed(2) + ' â‚¬';
            html2canvas(document.querySelector("#exportArea")).then(canvas => {
                const link = document.createElement('a');
                link.download = FedEx_Report.png;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function archiveMonth() {
            if(confirm('ØªÙ‚ÙÙŠÙ„ Ø§Ù„Ø´Ù‡Ø± Ù‡ÙŠØµÙØ± Ø§Ù„Ø±ØµÙŠØ¯ ÙˆÙŠØ­ÙØ¸Ù‡ØŸ')) {
                db.archive += db.logs.reduce((a, b) => a + b.val, 0);
                db.logs = []; save();
            }
        }

        function save() {
            localStorage.setItem('fedex_v20', JSON.stringify(db));
            updateUI();
        }

        function updateUI() {
            let net = db.logs.reduce((a, b) => a + b.val, 0);
            let p = db.logs.filter(l => l.type === 'delivery').reduce((a, b) => a + (b.val/PRICE), 0);
            let w = db.logs.filter(l => l.val < 0).reduce((a, b) => a + Math.abs(b.val), 0);
            document.getElementById('netBalance').innerText = â‚¬${net.toFixed(2)};
            document.getElementById('totalParcels').innerText = Math.round(p);
            document.getElementById('totalWithdrawn').innerText = w.toFixed(1) + 'â‚¬';
            if(db.archive !== 0) {
                document.getElementById('archiveSum').innerText = Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø³Ø§Ø¨Ù‚: â‚¬${db.archive.toFixed(2)};
                document.getElementById('archiveSum').classList.remove('hidden');
            }
        }
        updateUI();
    </script>
</body>
</html>
